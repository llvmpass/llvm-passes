# Individual experiments on the influence of pass order

This folder contains a variety of scripts to compare optimization sequences on individual source files, including random code generated by `llvm-stress`.

## Associativity

`assoc.sh` generates a random program and optimizes it with -dse (Dead Store Elimination, an elaborate function pass with several analysis dependencies) and -dce (Dead Code Elimination, a simple function-level pass without dependencies).

It generates several versions of the optimized program by optimizing with both passes at once and in several calls to opt, in bytecode, text IR and object form.

The output files can then be compared; for bytecode and object code a `diff` is enough, for text IR this is `diff` up to the module name comment, which records the name of the source file.

## Manually reproducing `opt -O3`

`manual-opt.sh` takes as input a C source file and optimizes it with `opt -O3` and `opt` with a custom set of passes. `manual-opt-O3.txt` is provided to reproduce the effect of `opt -O3`. The resulting IR is compared - to date it has always been the same.

The script also tries to perform the provided optimizations with a different call to `opt` for each line of the file ("split the sequence"). This is to match the actual behavior of the clang optimization, but it fails on some fails. Still needs investigation.
